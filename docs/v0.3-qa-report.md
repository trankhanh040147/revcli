# v0.3.0 QA Testing Report

**Status:** Complete

**Tested Features:**
- Preset Management (all commands tested and verified)

---

## 1. Code Block Highlighting & Navigation

### Code Block Detection

- [ ] Code blocks detected in initial review response
- [ ] Code blocks detected in chat follow-up responses
- [ ] Multiple code blocks in single response detected correctly
- [ ] Code blocks with various languages detected (go, python, javascript, c++, c#, f#, objective-c)
- [ ] Code blocks without language identifier detected (empty language)

### Visual Highlighting

- [ ] Active code block shows purple border (#7C3AED)
- [ ] Border is visible and distinct
- [ ] Only one code block highlighted at a time
- [ ] Highlighting updates when navigating between blocks
- [ ] Highlighting persists when scrolling

### Navigation

- [ ] `[` key navigates to previous code block
- [ ] `]` key navigates to next code block
- [ ] Navigation wraps (from first to last, last to first)
- [ ] Viewport scrolls to show active code block
- [ ] Navigation works with multiple code blocks in review
- [ ] Navigation works with code blocks in chat responses
- [ ] Navigation works when code blocks span across review and chat

### Smart Yank

- [ ] `yb` yanks the currently highlighted code block
- [ ] Yanked content is correct (no ANSI codes, just code)
- [ ] Falls back to last code block if none highlighted
- [ ] Works for code blocks in review response
- [ ] Works for code blocks in chat responses
- [ ] Visual feedback shows "✓ Copied code block to clipboard!"

### Contextual Hints

- [ ] Footer shows code block navigation hint when block is active
- [ ] Hint shows correct block number (e.g., "Block 2/5")
- [ ] Hint disappears when no code block is active

---

## 2. Chat Enhancements

### Request Cancellation

- [ ] `Ctrl+X` cancels streaming request during initial review
- [ ] `Ctrl+X` cancels streaming request during chat response
- [ ] Partial response is retained after cancellation
- [ ] "Request cancelled" feedback message appears
- [ ] Can continue chatting after cancellation
- [ ] New requests work after cancellation

### Prompt History

- [ ] `Ctrl+P` navigates to previous prompt in chat mode
- [ ] `Ctrl+N` navigates to next prompt in chat mode
- [ ] History wraps correctly (from first to last, last to first)
- [ ] Prompts saved when sent with `Alt+Enter`
- [ ] History persists across chat sessions in same review
- [ ] Empty prompt clears textarea when navigating beyond last
- [ ] Can edit and resend prompts from history

---

## 3. Preset Management

### Preset List

- [X] `revcli preset list` shows all built-in presets
- [X] Presets display with descriptions
- [X] Empty custom preset directory handled gracefully
- [X] `revcli preset list` shows all custom presets
- [X] Built-in and custom presets are clearly separated

### Preset Create

- [X] `revcli preset create <name>` creates preset interactively
- [X] Required name, show error when no name is provided
- [X] Duplicate preset names rejected
- [X] File saved to `~/.config/revcli/presets/<lowercase-name>.yaml`
- [X] Preset created with name, description, and prompt
- [X] Directory created if it doesn't exist
- [X] Success message displayed
- [X] Preset name normalized to lowercase
- [ ] Invalid YAML handled gracefully

#### [BUGS]

- [X] **Bug #01:**  The `preset create` command fails when users enter multi-word descriptions because fmt.Scanln() only reads up to the first whitespace.

### Preset Delete

- [X] `revcli preset delete <name>` deletes custom preset
- [X] Built-in presets cannot be deleted (error message)
- [X] Confirmation prompt works (y/N)
- [X] File removed from filesystem
- [X] Success message displayed
- [X] Case-insensitive deletion works
- [X] Non-existent preset shows error

### Preset Show

- [X] `revcli preset show <name>` displays preset details
- [X] Shows name, description, and prompt
- [X] Works for built-in presets
- [X] Works for custom presets
- [X] Case-insensitive lookup works
- [X] Non-existent preset shows error

#### [BUGS]

- [X] **Bugs #02**
  - Recommend preset: Can not list custom presets when mistype
  - Recommend feature: Implement fuzzy matching when mistyping

### Preset Edit

- [X] `revcli preset edit <name>` edits custom preset interactively
- [X] Can edit description and prompt (name is read-only)
- [X] Preset file updated after editing
- [X] Built-in presets cannot be edited (error message)
- [X] Non-existent preset shows error
- [X] Shows current values as defaults when editing
- [X] Name editing disabled to prevent data loss
- [X] External editor used for prompt editing (enables cursor movement)

#### [BUGS]

- [X] **IS09**: Fail to edit when enter a different name - Fixed: Name editing disabled, displayed as read-only
- [X] **IS10**: Not enter default value when editing - Fixed: Improved prompts with clearer default value display
- [X] **IS11**: Can not move cursor up and down when edit prompt - Fixed: Uses external editor (`$EDITOR` or `vi`) for multiline editing
- [X] **IS12**: Preset files when saved got `\n` instead of breaks - Fixed: Custom YAML marshaling uses literal block scalars (`|`)

### Preset Open

- [X] `revcli preset open <name>` opens preset file in editor
- [X] Uses `$EDITOR` environment variable
- [X] `revcli preset open` (no args) opens preset directory in file manager
- [X] Non-existent preset shows error + fuzzy find
- [ ] Falls back to `vi` if `$EDITOR` not set
- [ ] Linux: uses `xdg-open`
- [ ] macOS: uses `open`
- [ ] Windows: uses `explorer`
- [ ] Built-in presets show appropriate error message

### Preset Path

- [X] `revcli preset path <name>` shows preset file path
- [X] `revcli preset path` (no args) shows preset directory path
- [X] Paths are correct and accessible
- [X] Built-in presets show appropriate message
- [X] Non-existent preset shows error

### Preset Default

- [X] `revcli preset default <name>` sets default preset
- [X] `revcli preset default` shows current default preset
- [X] `revcli preset default --unset` clears default preset
- [X] Default preset saved to `~/.config/revcli/config.yaml`
- [X] Config file created if it doesn't exist
- [X] `--preset` flag overrides default preset
- [X] Default preset loads automatically in `review` command when `--preset` not provided
- [ ] Invalid default preset handled gracefully (preset deleted but still in config)

### Preset Replace Mode

- [X] `revcli review --preset <name> --preset-replace` replaces base prompt
- [X] `revcli review -p <name> -R` works as short alias
- [X] `revcli review -h` shows `--preset-replace` flag in help
- [ ] Preset YAML with `replace: true` replaces base prompt
- [X] Preset YAML with `replace: false` appends to base prompt (default)
- [X] `--preset-replace` flag overrides preset YAML `replace` field
- [X] Mode indicator shows "[mode: replace]" or "[mode: append]" in review output
- [X] Replace mode works with custom presets
- [X] Replace mode works with built-in presets
- [X] Replace mode works with default preset

### Preset System Prompt

- [X] `revcli preset system show` displays current system prompt
- [X] Shows custom prompt if exists, otherwise shows default
- [X] `revcli preset system edit` allows editing system prompt
- [X] Custom system prompt saved to `~/.config/revcli/presets/system.yaml`
- [ ] `revcli preset system reset` restores default system prompt
- [ ] Custom system prompt loads automatically in review command
- [ ] Default system prompt used when custom doesn't exist

### Preset Usage

- [X] `revcli review --preset <name>` uses preset correctly
- [X] Custom presets work in review command
- [X] Built-in presets work in review command
- [X] Case-insensitive preset names work
- [X] Default preset loads automatically when `--preset` not specified
- [X] `--preset` flag overrides default preset

---

## 4. Regression Testing

### Existing Features

- [X] Short flag aliases work (`-s`, `-b`, `-m`, `-f`, `-i`, `-I`, `-k`, `-p`, `-v`)
- [X] Vim navigation works (`j/k`, `g/G`, `Ctrl+d/u/f/b`)
- [X] Search works (`/`, `n/N`, `Tab` toggle)
- [X] Help overlay works (`?` key)
- [X] Yank commands work (`y`, `Y`, `yb`)
- [X] Chat mode works (`Enter` to enter, `Alt+Enter` to send)
- [X] Review presets work (`--preset` flag)

### Bug Fixes Verification

- [ ] **Bug 1 Fixed:** Code block line numbers match viewport (test with review + chat)
- [ ] **Bug 2 Fixed:** Languages with special chars detected (`c++`, `c#`, `f#`, `objective-c`)
- [ ] **Bug 3 Fixed:** Preset case sensitivity works (create `MyPreset`, delete `mypreset`)

---

## 5. Edge Cases & Error Handling

### Code Blocks

- [ ] Empty code blocks handled
- [ ] Code blocks with only whitespace handled
- [ ] Very long code blocks handled
- [ ] Code blocks with special characters handled
- [ ] Nested code blocks (if possible in markdown) handled
- [ ] Code blocks at end of content handled
- [ ] Code blocks at start of content handled

### Chat

- [ ] Very long prompts handled
- [ ] Empty prompts rejected
- [ ] Special characters in prompts handled
- [ ] Multiple rapid cancellations handled
- [ ] History with many prompts handled

### Presets

- [ ] Very long preset names handled
- [ ] Preset names with special characters handled
- [ ] Very long preset prompts handled
- [ ] Missing preset directory handled
- [ ] Corrupted preset YAML handled
- [ ] Permissions issues handled

---

## 6. UI/UX Testing

### Visual

- [ ] Code block border is visible in various terminal themes
- [ ] Border doesn't break layout
- [ ] Footer hints are readable
- [ ] Help overlay displays correctly
- [ ] No visual glitches when navigating

### Performance

- [ ] Large reviews with many code blocks perform well
- [ ] Navigation is smooth
- [ ] No lag when highlighting code blocks
- [ ] Rendering is fast

### Accessibility

- [ ] All features accessible via keyboard
- [ ] Help overlay shows all keybindings
- [ ] Error messages are clear
- [ ] Success messages are clear

---

## 7. Cross-Platform (if applicable)

- [ ] Works on Linux
- [ ] Works on macOS (if applicable)
- [ ] Works on Windows (if applicable)
- [ ] Terminal compatibility verified

---

## Test Results Summary

**Overall Status:** Pass

**Notes:**
- Preset Management features fully tested and verified
- Code Block Highlighting and Chat Enhancements will be tested in v0.3.1

---

## New Issues:

> **NOTES:** Issues relating to this current version

#rv-is-preset

- [X] **IS01**  : In `~/.config/revcli/presets/` : Do not have custom presets, user can't edit custom presets
  - **Fixed:** Added `revcli preset edit <name>` command
- [X] **IS02** Missing feature: let user edit preset in command line or edit file manually
  - **Fixed:** Added `revcli preset edit` command and `revcli preset open` command for manual editing
- [X] **IS03:** Missing feature: open preset folder/file
  - **Fixed:** Added `revcli preset open` (opens in editor/file manager) and `revcli preset path` (shows path) commands
- [X] **IS04** Missing feature: set default preset
  - **Fixed:** Added `revcli preset default` command and config.yaml support for default preset
- [X] **IS05**: Preset got overriden by system prompt
  - **Fixed:** Added `replace` field to preset YAML and `--preset-replace` flag to review command
    1. ✅ Allow presets to optionally replace (not append to) the base prompt
    2. ✅ Add a flag like --preset-replace to completely override the base prompt
    3. ⏳ Allow user to modify system prompt (Future feature)

**|START| Preset REPLACE mode**
- [X] **IS06** No helper found when run `rv review -h`
  - **Fixed:** Added `--preset-replace` flag to help examples in command Long description
- [X] **IS07** Flag is too long, not great for typing (Need to be verified)
  - **Fixed:** Added short alias `-R` for `--preset-replace` flag using `BoolVarP`
**|END|Preset REPLACE mode**

- [X] **IS08** Missing feature: edit system prompt --> treat it as a custom preset file
  - **Fixed:** Added `preset system` command with `show/edit/reset` subcommands. Can be customized via `~/.config/revcli/presets/system.yaml`

*Sort by priority*
- [x] IS12: preset files when saved got `\n` instead of breaks. Hard for edit preset via EDITOR - Fixed: Custom YAML marshaling uses literal block scalars 
- [x] IS11: Can not move cursor up and down when edit *prompt* (verify with create/edit) - Fixed: External editor used for prompt editing
- [x] IS09: Fail to edit when enter a different name (Consider disable edit *name*) - Fixed: Name editing disabled, displayed as read-only
- [x] IS10: Not enter default value when editing (still show default value, so not a big deal) - Fixed: Improved prompts with clearer default value display

## New Features

> **NOTES:** These features maybe implemented in this phase or be noted in later release if note too much relevant to current version

#rv-feat-preset

- [ ] **FT01**: preset cp
- [ ] **FT02**: Interactive preset management:
  - [ ] `preset manage` : Open a panel which users can (create, edit, delete, cp, choose default, go) interactively (Is it possible ?) --> Later releases
- [ ] **FT03**: Able to change preset in follow-up questions
- [ ] **FT04**: Able to change language (Vietnamese, English,...)
- [ ] **FT05:** Programming languages presets
- [ ] **FT06:** Auto create custom presets + system prompt as files, allow user to treat them like a custom presets (remove the definition of built-in preset)
- [ ] **FT07:** Refactor preset feature --> Merge preset system + custom presets + built-in presets --> Treat all as presets, but with diffrent type one subcommand, only.
  - Make the preset.go file shorter
  - Make less commands for preset management
